{"host":"petstore.swagger.io","protocol":"http","basePath":"/v2","rules":[{"path":"/pet","method":"post","produces":["application/xml","application/json"],"frontendPath":"/pet","requestRules":[{"policyName":"mg-req-transformation","parameters":[{"name":"name","value":"Healthy check before send request","type":"String"},{"name":"description","value":"While creating a pet, maybe User input the incorrect parameter for the payload, as we know we type the \"catalog\" to \"Catalog\" uppercase the first letter  or there is a space in the parameter like \" catalog\". Even if some evil developer use inject a script in the parameter value like \"name = '<script src=\"http://evilwebsite.inject.js\">'\" to attack the web via the XXS.\nIn the piece of code, we add a validation and apply a fix to the wrong parameter name like transform the \" Catalog\" to \"catalog\" and \"name = '<script src=\"http://evilwebsite.inject.js\">\" to 'name = &lt script src=http://evilwebsite.inject.js&rt'.","type":"String"},{"name":"formatRequestFunc","value":"  function transformPayload(payload) {\n    var _ = require(\"lodash\");\n    for (var prop in payload) {\n      var temp = payload[prop];\n      var tempProp = prop;\n      // Remove the space in the property.\n      prop = _.trim(prop);\n      // LowerCase the first letter for the property.\n      prop = prop.charAt(0).toLowerCase() + prop.slice(1);\n      if(prop !== tempProp) {\n        payload[prop] = temp;\n        delete payload[tempProp];\n      }\n      if(!_.isEmpty(temp) && _.isPlainObject(temp)){\n        transformPayload(temp);\n      }else if(_.isArray(temp) && temp.length) {\n        for (var i = 0, len = temp.length, item; i < len; i++) {\n          item = temp[i];\n          transformPayload(item);\n        }\n      }else if(!_.isEmpty(temp)){\n        payload[prop] = temp.replace(/\\</g, \"&lt\").replace(/\\>/g, \"&gt\");\n      }\n    }\n    return payload;\n  }\n  payload = transformPayload(payload);\n  done(payload);","type":"String"}]}],"responseRules":[{"policyName":"mg-res-transformation","parameters":[{"name":"name","value":"cus","type":"String"},{"name":"description","type":"String"},{"name":"formatResponseFunc","value":"  var uuid = require('uuid');\n  var moment = require('moment');\n  res.uuidX = uuid.v1();\n  res.momentA=moment().format();\n  done(res);","type":"String"}]},{"policyName":"mg-res-custom-js","parameters":[{"name":"name","value":"cus2","type":"String"},{"name":"description","type":"String"},{"name":"formatResponseFunc","value":"  var uuid = require ('uuid');\n  var moment = require ('moment');\n  //res.body.uuidparse = uuid.parse('797ff043-11eb-11e1-80d6-510998755d10');\n  res.body.vendor = 'abc';\n  res.body.output = uuid.v1();\n  res.body.moment=moment().format();\n  done(res);","type":"String"}]}],"operationId":"addPet","consumes":["application/json","application/xml"]},{"path":"/pet","method":"put","produces":["application/xml","application/json"],"frontendPath":"/pet","requestRules":[{"policyName":"mg-req-transformation","parameters":[{"name":"name","value":"cus","type":"String"},{"name":"description","type":"String"},{"name":"formatRequestFunc","value":"  var categoryName = payload.category.name;\n  var moment = require('moment');\n  if (categoryName) {\n    var iconUrl = \"http://test.com/\"+ moment().format();\n    switch (categoryName) {\n    case 'dog':\n      iconUrl += 'dog.png';\n      break;\n    case 'cat':\n      iconUrl += 'cat.png';\n      break;\n    default:\n      iconUrl += 'default.png';\n  }\n    payload.photoUrls = [iconUrl];\n  }\n  done(payload);","type":"String"}]}],"responseRules":[],"operationId":"updatePet","consumes":["application/json","application/xml"]},{"path":"/user","method":"post","produces":["application/xml","application/json"],"frontendPath":"/user","requestRules":[],"responseRules":[],"operationId":"createUser","consumes":[]},{"path":"/user/login","method":"get","produces":["application/xml","application/json"],"frontendPath":"/user/login","requestRules":[],"responseRules":[],"operationId":"loginUser"},{"path":"/pet/{petId}","method":"get","produces":["application/xml","application/json"],"frontendPath":"/pet/{petId}","requestRules":[],"responseRules":[{"policyName":"mg-res-custom-js","parameters":[{"name":"name","value":"c","type":"String"},{"name":"description","type":"String"},{"name":"formatResponseFunc","value":" console.log(res);\n  done(res);","type":"String"}]}],"operationId":"getPetById"},{"path":"/pet/{petId}","method":"post","produces":["application/xml","application/json"],"frontendPath":"/pet/{petId}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"  done(payload);"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/pet/{petId}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"  done(res);"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[],"operationId":"updatePetWithForm","consumes":["application/x-www-form-urlencoded"]},{"path":"/pet/{petId}","method":"delete","produces":["application/xml","application/json"],"frontendPath":"/pet/{petId}","requestRules":[],"responseRules":[],"operationId":"deletePet"},{"path":"/store/order","method":"post","produces":["application/xml","application/json"],"frontendPath":"/store/order","requestRules":[{"policyName":"mg-req-custom-js","parameters":[{"name":"name","value":"testReqHeader","type":"String"},{"name":"description","type":"String"},{"name":"formatRequestFunc","value":" var headers=require('mf-headers');\n  headers.addHeader('Accept','application/xml');\n  headers.addHeader('userheader1','h1,h2.org,h3 withspace,h4=888.abcd');\n  done(req);","type":"String"}]}],"responseRules":[],"operationId":"placeOrder","consumes":[]},{"path":"/user/logout","method":"get","produces":["application/xml","application/json"],"frontendPath":"/user/logout","requestRules":[],"responseRules":[],"operationId":"logoutUser"},{"path":"/pet/findByTags","method":"get","produces":["application/xml","application/json"],"frontendPath":"/pet/findByTags","requestRules":[],"responseRules":[],"operationId":"findPetsByTags"},{"path":"/store/inventory","method":"get","produces":["application/json"],"frontendPath":"/store/inventory","requestRules":[],"responseRules":[{"policyName":"mg-res-custom-js","parameters":[{"name":"name","value":"custom-checkAsyncModule","type":"String"},{"name":"description","type":"String"},{"name":"formatResponseFunc","value":"var _ = require('lodash');\n  var async = require('async');\n  var request = require('request');\n  async.series([\n  function(callback)\n    {\n      request('http://www.outlook.com', function (error, response, body) \n        {\n         if (!error && response.statusCode == 200) \n         {\n           callback(null,response.statusCode);\n         }\n      });\n    },\n  function(callback)\n    {\n      request('http://www.yahoo.com', function (error, response, body) \n        {\n         if (!error && response.statusCode == 200) \n         {\n           callback(null,response.statusCode);\n         }\n      });\n    }\n  ],\n  function(err, results)\n    {\n      res.body = {\n         raw: res.body,\n    \t total: res.body.length,\n   \t\t vendor: 'TIBCO',\n    \t result: results\n       };\n    done(res);\n  }\n );\n","type":"String"}]}],"operationId":"getInventory"},{"path":"/user/{username}","method":"get","produces":["application/xml","application/json"],"frontendPath":"/user/{username}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"\tdone(payload);\n"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/user/{username}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"\tdone(res);\n"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[],"operationId":"getUserByName"},{"path":"/user/{username}","method":"put","produces":["application/xml","application/json"],"frontendPath":"/user/{username}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"\tdone(payload);\n"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/user/{username}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"\tdone(res);\n"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[],"operationId":"updateUser","consumes":[]},{"path":"/user/{username}","method":"delete","produces":["application/xml","application/json"],"frontendPath":"/user/{username}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"\tdone(payload);\n"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/user/{username}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"\tdone(res);\n"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[],"operationId":"deleteUser"},{"path":"/pet/findByStatus","method":"get","produces":["application/xml","application/json"],"frontendPath":"/pet/findByStatus","requestRules":[{"policyName":"mg-req-throttle","parameters":[{"name":"numberOfTransactionsPerSecond","value":1,"type":"Number","description":"Number of transactions allowed in rolling window"}]},{"policyName":"mg-req-caching","parameters":[{"name":"timeUnit","value":"seconds","type":"String"},{"name":"time","value":10,"type":"Number"}]},{"policyName":"mg-req-custom-js","parameters":[{"name":"name","value":"Set default status","type":"String"},{"name":"description","value":"Add \"all\" to \"status\" in query if it's empty","type":"String"},{"name":"formatRequestFunc","value":"  var _ = require('lodash');\n  if ( _.isEmpty(_.trim(req.query.status))) {\n    req.query.status = 'all';\n  }\n  done(req);","type":"String"}]},{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"req.query.status && /all/.test(req.query.status)"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":""},{"name":"destination","type":"String","description":"The destination of this route.","value":"/v2/pet/findByStatus?status=pending"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":" var _ = require('lodash');\n if ( _.isArray(res) ) {\n   res = {\n     response: res,\n     isRouted: true\n   };\n }\n  done(res);"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[{"policyName":"mg-res-transformation","parameters":[{"name":"name","value":"Add vendor field","type":"String"},{"name":"description","value":"Add an vendor field into the response","type":"String"},{"name":"formatResponseFunc","value":"  var _ = require('lodash');\n  // ensure the response is an object\n  if (_.isArray(res)) {\n    res = {\n      response: res\n    };\n  }\n  res.vendor = 'TIBCO Cloud';\n  var uuid = require('uuid');\n  res.uuidX = uuid.v1();\n  var moment = require('moment');\n  res.momentA=moment().format();\n  done(res);","type":"String"}]},{"policyName":"mg-res-custom-js","parameters":[{"name":"name","value":"Add total number","type":"String"},{"name":"description","value":"Add total number of the items to the response","type":"String"},{"name":"formatResponseFunc","value":"  var _ = require('lodash');\n  if (_.isArray(res)) {\n    res.push({\n      total: res.body.length\n    });\n  } else if (_.isObject(res) && _.isArray(res.body.response)) {\n    res.body.total = res.body.response.length;\n  }\n  var uuid = require('uuid');\n  res.body.uuidX1 = uuid.v1();\n  var moment = require('moment');\n  res.body.momentB=moment().format();\n  done(res);","type":"String"}]}],"operationId":"findPetsByStatus"},{"path":"/user/createWithList","method":"post","produces":["application/xml","application/json"],"frontendPath":"/user/createWithList","requestRules":[],"responseRules":[],"operationId":"createUsersWithListInput","consumes":[]},{"path":"/user/createWithArray","method":"post","produces":["application/xml","application/json"],"frontendPath":"/user/createWithArray","requestRules":[{"policyName":"mg-req-throttle","parameters":[{"name":"numberOfTransactionsPerSecond","value":1,"type":"Number","description":"Number of transactions allowed in rolling window"}]},{"policyName":"mg-req-transformation","parameters":[{"name":"name","value":"Limit users number","type":"String"},{"name":"description","value":"Limit the users number can create one request, currently we limit to 3","type":"String"},{"name":"formatRequestFunc","value":"  // Limit the number of user can put on one time, for test purpose, limit to create 3 user at one time\n  var _ = require('lodash');\n  if(payload&&payload.length>=4){\n    var newPayload = _.slice(payload, 0, 3);\n    payload = newPayload;\n  }\n  done(payload);","type":"String"}]}],"responseRules":[{"policyName":"mg-res-transformation","parameters":[{"name":"name","value":"Add message","type":"String"},{"name":"description","value":"Add a message to response, let user know if pass more then 3 user, we will just save the first 3 users","type":"String"},{"name":"formatResponseFunc","value":"  var _ = require('lodash');\n  if(!res){\n    res = {\n      \"message\": \"If you pass more then 3 user, we just save the first 3 user, other user will be dropped\"\n    };\n  }else if(_.isObject(res)){\n    res.message = \"If you pass more then 3 user, we just save the first 3 user, other user will be dropped\";\n  }\n  done(res);","type":"String"}]}],"operationId":"createUsersWithArrayInput","consumes":[]},{"path":"/store/order/{orderId}","method":"get","produces":["application/xml","application/json"],"frontendPath":"/store/order/{orderId}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"  done(payload);"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/store/order/{orderId}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"  done(res);"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[{"policyName":"mg-res-custom-js","parameters":[{"name":"name","value":"testRespHeaders","type":"String"},{"name":"description","type":"String"},{"name":"formatResponseFunc","value":" var headers=require('mf-headers');\n  headers.addHeader('a','d');\n  done(res);","type":"String"}]}],"operationId":"getOrderById"},{"path":"/store/order/{orderId}","method":"delete","produces":["application/xml","application/json"],"frontendPath":"/store/order/{orderId}","requestRules":[{"policyName":"mg-req-routing","parameters":[{"name":"routes","items":[{"parameters":[{"name":"condition","type":"String","description":"The condition of a route","value":"true"},{"name":"preDestTransformFunction","type":"String","description":"The transformation function before destination.","value":"  done(payload);"},{"name":"destination","type":"String","description":"The destination of this route.","value":"http://petstore.swagger.io/v2/store/order/{orderId}"},{"name":"postDestTransformFunction","type":"String","description":"The transformation function after destination.","value":"  done(res);"}]}],"type":"Array","description":"An array of routes."}]}],"responseRules":[],"operationId":"deleteOrder"},{"path":"/pet/{petId}/uploadImage","method":"post","produces":["application/json"],"frontendPath":"/pet/{petId}/uploadImage","requestRules":[],"responseRules":[],"operationId":"uploadFile","consumes":["multipart/form-data"]}]}